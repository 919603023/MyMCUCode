C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Apps\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**********************************************************************************
   2           * ¹¤³ÌÃû  :²¦´òµç»°
   3           * ÃèÊö    :Í¨¹ıC51¿ª·¢°å¿ØÖÆÄ£¿é²¦´òÖ¸¶¨µç»°ºÅ
   4           * ÊµÑéÆ½Ì¨:C51
   5           * ¿â°æ±¾  :
   6          
   7          
   8           * Ó²¼şÁ¬½ÓËµÃ÷
   9             Ê¹ÓÃµ¥Æ¬´®¿ÚÓëGPRSÄ£¿éÍ¨ĞÅ 
  10             C51        GPRSÄ£¿é
  11             P30 (RXD)->RXD
  12             P31 (TXD)->TXD
  13             GND      ->GND
  14          
  15           * Èí¼ş¹¦ÄÜËµÃ÷
  16             °å×ÓÉÏµçºóÔËĞĞÖ¸Ê¾µÆRUNING_LED»áÒÔÒ»ÃëµÄÆµÂÊÉÁË¸
  17             ´ò¿ª´úÂëĞŞ¸Ä¶ÌĞÅÖĞĞÄºÅ¡¢½ÓÊÕ·½ÊÖ»úºÅºÍ¶ÌĞÅÄÚÈİ£¬±àÒë³É¹¦ºóÏÂÔØµ½µ¥Æ¬»úÀïÃæ£¬
  18             ¾Í¿ÉÒÔÊµÏÖ·¢ËÍÒ»ÌõÖĞÎÄ¶ÌĞÅ£¬ÖĞÎÄ¶ÌĞÅ¾ßÌåµÄ½âÎö¿ÉÒÔ²Î¿¼´®¿Úµ÷ÊÔ±Ê¼Ç
  19          **********************************************************************************/
  20          #include "config.h"
  21          #include "string.h"
  22          #include "delay.h"
  23          #include "uart.h"
  24          #include "stdio.h"
  25          #include "intrins.h"
  26          #define Buf1_Max 200            //´®¿Ú2»º´æ³¤¶È
  27          /*************  ±¾µØ³£Á¿ÉùÃ÷  **************/
  28          sbit RUNING_LED = P3^2;         //ÔËĞĞÖ¸Ê¾µÆ
  29          sbit io=P1^0;//dht11data¶Ë½Óµ¥Æ¬»úµÄP1^0¿Ú// 
  30          
  31          sbit rw=P3^6;//Ò»ÏÂÈıĞĞÊÇÉèÖÃlcd1602µÄÊ¹ÄÜ¶Ë// 
  32          
  33          sbit rs=P3^5; 
  34          
  35          sbit ep=P3^7; 
  36          
  37          typedef bit BOOL;//´ËÉùÃ÷Ò»¸ö²¼¶ûĞÍ±äÁ¿¼´Õæ»ò¼Ù// 
  38          
  39          unsigned char data_byte; 
  40          
  41          unsigned char RH,RL,TH,TL; 
  42          //code unsigned char *content="0891683108706505F011000D91683197985889F90008AA0C6D4B8BD55DF27ECF5B8C6210";/
             -/·¢ËÍ¶ÌĞÅÄÚÈİ
  43          code unsigned char *content="0891683108706505F011000D91688146255844F50008AA144F604ED659884E86969458C176845
             -FEB70B9505A";//·¢ËÍ¶ÌĞÅÄÚÈİ
  44          code char buff[] ="0891683110900805F011000D91683197985889F90008AA";
  45          code char *NumBuf[] = {"0030","0031","0032","0033","0034","0035","0036","0037","0038","0039"};
  46          code char  *RH_TM_Buf = "5EA64E3AFF1A";
  47          /************************¶ÌĞÅÄÚÈİ½âÎö**************************************/
  48          /*
  49             //¶ÌĞÅÖĞĞÄºÅ£¨µ¹Ğò£©       Ä¿±êÊÖ»ú£¨µ¹Ğò£©             ¶ÌĞÅÄÚÈİ£¨²âÊÔÒÑ¾­Íê³É£©
  50               8613800756500F           8613798985989F          
  51          0891 683108706505F0 1100 0D91 683197985889F9 0008AA   0C   6D4B8BD55DF27ECF5B8C6210
  52                 ºÚÁú½­  683110900805F0                                            ×Ö½ÚÊı
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 2   

  53                                                               
  54                                                            14   4F604ED659884E86969458C176845FEB70B9505A 
  55          */
  56          /*************  ±¾µØ±äÁ¿ÉùÃ÷  **************/
  57          
  58          xdata u8 Uart1_Buf[Buf1_Max];
  59          
  60          u8 Times=0,First_Int = 0,shijian=0,Second_2s,Uart_flag;//Uart_flagÎª´¦ÀíflagÎª1 Ê±£¬Ã»´¦Àí£¬Îª0Ê±´¦Àí¹ı
  61          
  62          bdata u8 Flag;//¶¨Ê±Æ÷±êÖ¾Î»
  63          sbit Timer0_start =Flag^0;  //¶¨Ê±Æ÷0ÑÓÊ±Æô¶¯¼ÆÊıÆ÷
  64          
  65          
  66          
  67          /*************  ±¾µØº¯ÊıÉùÃ÷  **************/
  68          void GPIO_config(void); //¶Ë¿Ú³õÊ¼»¯ÅäÖÃ
  69          void Timer0Init(void);  //¶¨Ê±Æ÷0³õÊ¼»¯
  70          void CLR_Buf1(void);    //Çå³ı´®¿Ú2½ÓÊÕ»º´æ
  71          u8 Find(u8 *a);         //²éÕÒ×Ö·û´®
  72          void Second_AT_Command(u8 *b,u8 *a,u8 wait_time); //·¢ËÍATÖ¸Áîº¯Êı
  73          void Set_Pdu_Mode(void);//ÉèÖÃ¶ÌĞÅÄ£Ê½PDU
  74          void Wait_CREG(void);   //²éÑ¯µÈ´ıÄ£¿é×¢²á³É¹¦
  75          void Send_Pdu_Sms(unsigned char *sms,int len);//·¢ËÍÒ»ÌõÖĞÎÄ¶ÌĞÅ
  76          void DHT_display();
  77          void receive();
  78          unsigned char receive_byte();
  79          void display(unsigned char addr,unsigned char q);
  80          void start();
  81          void lcd_init();
  82          void write_byte(unsigned char dat);
  83          void write_addr(unsigned char addr);
  84          void write_cmd(unsigned char cmd);
  85          BOOL lcd_bz();
  86          void delay1();
  87          void delay(unsigned char ms);
  88           void Delay1s() ;
  89           void Check_New_Message(void);
  90           void Back_Send_Sms();
  91          void Send_Sms(char *sms,int len);
  92          
  93          /*************  Íâ²¿º¯ÊıºÍ±äÁ¿ÉùÃ÷*****************/
  94          
  95          
  96          
  97          
  98          /*******************************************************************************
  99          * º¯ÊıÃû : main 
 100          * ÃèÊö   : Ö÷º¯Êı
 101          * ÊäÈë   : 
 102          * Êä³ö   : 
 103          * ·µ»Ø   : 
 104          * ×¢Òâ   : ´®¿Ú²¨ÌØÂÊÊÇ9600£¬GPRSÄ£¿éÄ¬ÈÏ²¨ÌØÂÊÊÇ115200£¬ĞèÒª×Ô¼ºÍ¨¹ı´®¿ÚÖúÊÖĞŞ¸Ä
 105                     Îª9600·½¿ÉÊ¹ÓÃ¡£ 
 106          *******************************************************************************/
 107          void main(void)
 108          {
 109   1        Timer0Init();  //³õÊ¼»¯¶¨Ê±Æ÷0
 110   1        //GPIO_config();
 111   1        EA=1; //¿ª×ÜÖĞ¶Ï
 112   1        
 113   1      Uart1Init();    //³õÊ¼»¯´®¿Ú9600
 114   1      Wait_CREG();    //²éÑ¯µÈ´ıÄ£¿é×¢²á³É¹
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 3   

 115   1        
 116   1        Send_Pdu_Sms(content,35);//·¢ËÍÒ»Ìõ¶ÌÏûÏ¢
 117   1        
 118   1        while(1)
 119   1        {
 120   2          if(Second_2s < 2)
 121   2          {
 122   3              //DHT_display();
 123   3            
 124   3          }
 125   2          if(Uart_flag == 1)
 126   2          {
 127   3          //  Check_New_Message();
 128   3          }
 129   2        }
 130   1        
 131   1      }
 132          /*******************************************************************************
 133          * º¯ÊıÃû : Check_Message_rec
 134          * ÃèÊö   : ¼ì²éÊÇ·ñÓĞĞÂĞÅÏ¢£¬²¢Ö´ĞĞĞÅÏ¢ÄÚÈİÖ¸Áî
 135          * ÊäÈë   : 
 136          * Êä³ö   : 
 137          * ·µ»Ø   : 
 138          * ×¢Òâ   : 
 139          *******************************************************************************/
 140          
 141          void Check_New_Message(void)
 142          {
 143   1        u8 temp=0;
 144   1        if(strstr(Uart1_Buf,"+CMT")!=NULL)      //Èô»º´æ×Ö·û´®ÖĞº¬ÓĞ"+CMT"¾Í±íÊ¾ÓĞĞÂµÄ¶ÌĞÅ
 145   1        {
 146   2          delay_ms(3);//µÈ´ıÊı¾İÈ«²¿½ÓÊÕÍê³É
 147   2          if(strstr(Uart1_Buf,"73AF58834FE1606F")!=NULL)//»ñÈ¡»·¾³ĞÅÏ¢
 148   2          {
 149   3          //µ÷ÓÃ·¢ËÍ¶ÌĞÅº¯Êı
 150   3            Back_Send_Sms();
 151   3          }
 152   2          else if(strstr(Uart1_Buf,"5173706F")!=NULL)//¹ØµÆ
 153   2          {
 154   3          //
 155   3          }
 156   2          else if(strstr(Uart1_Buf,"5F00706F")!=NULL)//¿ªµÆ
 157   2          {
 158   3          //
 159   3          }
 160   2          else if(strstr(Uart1_Buf,"62535F00753598CE6247")!=NULL)//´ò¿ªµç·çÉÈ
 161   2          {
 162   3          //
 163   3          } 
 164   2          else if(strstr(Uart1_Buf,"517395ED753598CE6247")!=NULL)//´ò¿ªµç·çÉÈ
 165   2          {
 166   3          //
 167   3          } 
 168   2          CLR_Buf1();
 169   2          //Second_AT_Command("AT+CMGD=1,4","OK",3);//É¾³ı¶ÌĞÅ
 170   2        }
 171   1      }
 172          
 173          
 174          /*******************************************************************************
 175          * º¯ÊıÃû : Uart1 
 176          * ÃèÊö   : ´®¿Ú1ÖĞ¶Ï·şÎñÈë¿Úº¯Êı
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 4   

 177          * ÊäÈë   : 
 178          * Êä³ö   : 
 179          * ·µ»Ø   : 
 180          * ×¢Òâ   : 
 181          *******************************************************************************/
 182          void Uart1() interrupt 4
 183          {
 184   1          if (RI)
 185   1          {
 186   2            RI = 0;                 //Çå³ıRIÎ»
 187   2            Uart1_Buf[First_Int] = SBUF;      //½«½ÓÊÕµ½µÄ×Ö·û´®´æµ½»º´æÖĞ
 188   2            First_Int++;                      //»º´æÖ¸ÕëÏòºóÒÆ¶¯
 189   2            if(First_Int > Buf1_Max)          //Èç¹û»º´æÂú,½«»º´æÖ¸ÕëÖ¸Ïò»º´æµÄÊ×µØÖ·
 190   2            {
 191   3              First_Int = 0;
 192   3            }
 193   2          }
 194   1          if (TI)
 195   1          {
 196   2              TI = 0;                 //Çå³ıTIÎ»
 197   2          }
 198   1          Uart_flag = 1;
 199   1      }
 200          /*******************************************************************************
 201          * º¯ÊıÃû : Timer0_ISR
 202          * ÃèÊö   : ¶¨Ê±Æ÷0ÖĞ¶Ï·şÎñÈë¿Úº¯Êı,20msÖĞ¶ÏÒ»´Î
 203          * ÊäÈë   : 
 204          * Êä³ö   : 
 205          * ·µ»Ø   : 
 206          * ×¢Òâ   : 
 207          *******************************************************************************/
 208          void Timer0_ISR() interrupt 1
 209          {
 210   1        static u8 Time_count=0;
 211   1        TL0 = 0x00;     //ÖØÖÃ¶¨Ê±Æ÷³õÖµ
 212   1        TH0 = 0xB8;     //ÖØÖÃ¶¨Ê±Æ÷³õÖµ  
 213   1        TR0=0;//¹Ø¶¨Ê±Æ÷
 214   1        
 215   1        Time_count++;
 216   1        if(Time_count>=50)
 217   1        {
 218   2          Time_count = 0;
 219   2          RUNING_LED =~RUNING_LED;
 220   2        }
 221   1        
 222   1        Second_2s++;
 223   1        if(Second_2s >= 100)
 224   1        {
 225   2          Second_2s = 0;
 226   2          
 227   2        }
 228   1        
 229   1        if(count_20ms) //20msÑÓÊ±¼ÆÊıÆ÷
 230   1          count_20ms--;
 231   1        if(Timer0_start)
 232   1        Times++;
 233   1        if(Times > (50*shijian))
 234   1        {
 235   2          Timer0_start = 0;
 236   2          Times = 0;
 237   2        }
 238   1        TR0=1;//¿ª¶¨Ê±Æ÷
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 5   

 239   1      }
 240          /*******************************************************************************
 241          * º¯ÊıÃû : GPIO_config
 242          * ÃèÊö   : IO¿ÚÅäÖÃº¯Êı
 243          * ÊäÈë   : 
 244          * Êä³ö   : 
 245          * ·µ»Ø   : 
 246          * ×¢Òâ   : 
 247          *******************************************************************************/
 248          void  GPIO_config(void)
 249          {
 250   1          RUNING_LED=0;
 251   1      }
 252          /*******************************************************************************
 253          * º¯ÊıÃû : Timer0Init
 254          * ÃèÊö   : ¶¨Ê±Æ÷0³õÊ¼»¯£¬20ms¶¨Ê±
 255          * ÊäÈë   : 
 256          * Êä³ö   : 
 257          * ·µ»Ø   : 
 258          * ×¢Òâ   : 
 259          *******************************************************************************/
 260          void Timer0Init(void)   //20ºÁÃë@11.0592MHz
 261          {
 262   1        AUXR &= 0x7F;   //¶¨Ê±Æ÷Ê±ÖÓ12TÄ£Ê½
 263   1        TMOD &= 0xF0;   //
 264   1        TMOD |= 0x01;   //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½£¬16Î»¶¨Ê±Æ÷
 265   1        TL0 = 0x00;     //ÉèÖÃ¶¨Ê±Æ÷³õÖµ
 266   1        TH0 = 0xB8;     //ÉèÖÃ¶¨Ê±Æ÷³õÖµ
 267   1        TF0 = 0;        //ÇåTF0±êÖ¾
 268   1        TR0 = 1;        //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 269   1        ET0 = 1;        //Ê¹ÄÜ¶¨Ê±Æ÷0ÖĞ¶Ï
 270   1      }
 271          /*******************************************************************************
 272          * º¯ÊıÃû : CLR_Buf1
 273          * ÃèÊö   : Çå³ı´®¿Ú2»º´æÊı¾İ
 274          * ÊäÈë   : 
 275          * Êä³ö   : 
 276          * ·µ»Ø   : 
 277          * ×¢Òâ   : 
 278          *******************************************************************************/
 279          void CLR_Buf1(void)
 280          {
 281   1        u16 k;
 282   1        for(k=0;k<Buf1_Max;k++)      //½«»º´æÄÚÈİÇåÁã
 283   1        {
 284   2          Uart1_Buf[k] = 0x00;
 285   2        }
 286   1          First_Int = 0;              //½ÓÊÕ×Ö·û´®µÄÆğÊ¼´æ´¢Î»ÖÃ
 287   1        Uart_flag = 0;
 288   1      }
 289          
 290          /*******************************************************************************
 291          * º¯ÊıÃû : Find
 292          * ÃèÊö   : ÅĞ¶Ï»º´æÖĞÊÇ·ñº¬ÓĞÖ¸¶¨µÄ×Ö·û´®
 293          * ÊäÈë   : 
 294          * Êä³ö   : 
 295          * ·µ»Ø   : unsigned char:1 ÕÒµ½Ö¸¶¨×Ö·û£¬0 Î´ÕÒµ½Ö¸¶¨×Ö·û 
 296          * ×¢Òâ   : 
 297          *******************************************************************************/
 298          
 299          u8 Find(u8 *a)
 300          { 
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 6   

 301   1        if(strstr(Uart1_Buf,a)!=NULL)
 302   1            return 1;
 303   1        else
 304   1            return 0;
 305   1      }
 306          
 307          /*******************************************************************************
 308          * º¯ÊıÃû : Second_AT_Command
 309          * ÃèÊö   : ·¢ËÍATÖ¸Áîº¯Êı
 310          * ÊäÈë   : ·¢ËÍÊı¾İµÄÖ¸Õë¡¢·¢ËÍµÈ´ıÊ±¼ä(µ¥Î»£ºS)
 311          * Êä³ö   : 
 312          * ·µ»Ø   : 
 313          * ×¢Òâ   : 
 314          *******************************************************************************/
 315          
 316          void Second_AT_Command(u8 *b,u8 *a,u8 wait_time)         
 317          {
 318   1        u8 i;
 319   1        u8 *c;
 320   1        c = b;                    //±£´æ×Ö·û´®µØÖ·µ½c
 321   1        CLR_Buf1(); 
 322   1        i = 0;
 323   1        while(i == 0)                    
 324   1        {
 325   2          if(!Find(a))           //²éÕÒĞèÒªÓ¦´ğµÄ×Ö·û
 326   2          {
 327   3            if(Timer0_start == 0)//³¬Ê±ÖØĞÂ·¢ËÍÃüÁî
 328   3            {
 329   4              b = c;             //½«×Ö·û´®µØÖ·¸øb
 330   4              for (b; *b!='\0';b++)
 331   4              {
 332   5                UART1_SendData(*b);
 333   5              }
 334   4              UART1_SendLR(); 
 335   4              Times = 0;
 336   4              shijian = wait_time;
 337   4              Timer0_start = 1;  //¿ªÊ¼¼ÆÊ±
 338   4             }
 339   3          }
 340   2          else
 341   2          {
 342   3            i = 1;
 343   3            Timer0_start = 0;  
 344   3          }
 345   2        }
 346   1        CLR_Buf1(); 
 347   1      }
 348          
 349          /*******************************************************************************
 350          * º¯ÊıÃû : Set_Pdu_Mode
 351          * ÃèÊö   : ÉèÖÃ¶ÌĞÅÎªPDUÎÄ±¾Ä£Ê½
 352          * ÊäÈë   : 
 353          * Êä³ö   : 
 354          * ·µ»Ø   : 
 355          * ×¢Òâ   : 
 356          *******************************************************************************/
 357          void Set_Pdu_Mode(void)
 358          {
 359   1        Second_AT_Command("ATE0","OK",3);                     //È¡Ïû»ØÏÔ  
 360   1        Second_AT_Command("AT+CNMI=3,2,0,0,0","OK",3);              //ĞÂ¶ÌĞÅÖ±½ÓÊä³ö
 361   1        Second_AT_Command("AT+CMGF=0","OK",3);                //ÉèÖÃPDUÄ£Ê½ 
 362   1        Second_AT_Command("AT+CPMS=\"SM\",\"SM\",\"SM\"","OK",3);//ËùÓĞ²Ù×÷¶¼ÔÚSIM¿¨ÖĞ½øĞĞ
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 7   

 363   1      }
 364          /*******************************************************************************
 365          * º¯ÊıÃû : Send_Pdu_Sms
 366          * ÃèÊö   : ·¢ËÍPDUÎÄ±¾¶ÌĞÅ
 367          * ÊäÈë   : 
 368          * Êä³ö   : 
 369          * ·µ»Ø   : 
 370          * ×¢Òâ   : 
 371          *******************************************************************************/
 372          void Send_Pdu_Sms(unsigned char *sms,int len)
 373          {
 374   1        char buf[20] = "";
 375   1        sprintf(buf,"AT+CMGS=%d",len);
 376   1        Second_AT_Command(buf,">",3); //·¢ËÍÊı¾İ³¤¶È£º27£¨¾ßÌåµÄ¼ÆËã·½·¨¿´´®¿Úµ÷ÊÔ±È½Ï£©½ÓÊÕµ½¡°>¡±²Å·¢ËÍ¶ÌĞÅÄÚÈİ
 377   1        UART1_SendString(sms);     //·¢ËÍ¶ÌĞÅÄÚÈİ
 378   1        UART1_SendData(0X1A);          //·¢ËÍ½áÊø·û
 379   1      }
 380          
 381          /*******************************************************************************
 382          * º¯ÊıÃû : Wait_CREG
 383          * ÃèÊö   : µÈ´ıÄ£¿é×¢²á³É¹¦
 384          * ÊäÈë   : 
 385          * Êä³ö   : 
 386          * ·µ»Ø   : 
 387          * ×¢Òâ   : 
 388          *******************************************************************************/
 389          void Wait_CREG(void)
 390          {
 391   1        u8 i;
 392   1        u8 k;
 393   1        i = 0;
 394   1        CLR_Buf1();
 395   1        while(i == 0)             
 396   1        {
 397   2          CLR_Buf1();        
 398   2          UART1_SendString("AT+CREG?");//²éÑ¯Ä£¿éÍøÂç×¢²á×´Ì¬
 399   2          UART1_SendLR();
 400   2          delay_ms(250);              
 401   2            for(k=0;k<Buf1_Max;k++)           
 402   2            {
 403   3            if(Uart1_Buf[k] == ':')
 404   3            {
 405   4              if((Uart1_Buf[k+4] == '1')||(Uart1_Buf[k+4] == '5')) //±íÃ÷ÍøÂç×¢²á³É¹¦
 406   4              {
 407   5                i = 1;
 408   5                break;
 409   5              }
 410   4            }
 411   3          }
 412   2        }
 413   1      }
 414          
 415          
 416          
 417          
 418          /***********************************************/
 419          
 420          
 421           void Delay1s()                //@11.0592MHz
 422          {
 423   1              unsigned char i, j, k;
 424   1      
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 8   

 425   1              _nop_();
 426   1              i = 8;
 427   1              j = 1;
 428   1              k = 243;
 429   1              do
 430   1              {
 431   2                      do
 432   2                      {
 433   3                              while (--k);
 434   3                      } while (--j);
 435   2              } while (--i);
 436   1      }
 437          
 438          //***************ÑÓÊ±º¯Êı************************************* 
 439          
 440           void delay(unsigned char ms) //ÑÓÊ±Ä£¿é// 
 441          
 442          { 
 443   1      
 444   1        unsigned char i; 
 445   1      
 446   1        while(ms--)                 
 447   1      
 448   1              
 449   1      
 450   1       for(i=0;i<100;i++); 
 451   1      
 452   1      } 
 453          
 454          
 455          void delay1()//Ò»¸öforÑ­»·´ó¸ÅĞèÒª8¸ö¶à»úÆ÷ÖÜÆÚª£Ò»¸ö»úÆ÷ÖÜÆÚÎª1usª¡¾§ÕñÎª12MHzª¢ª£Ò²¾ÍÊÇËµ±¾º¯ÊıÑÓÊ±8us¶à
             -ª¡´ËÑÓÊ±º¯Êı±ØĞëµÂÉÔÎ¢¾«È·Ò»µãª¢ 
 456          
 457          { 
 458   1      
 459   1        unsigned char i; 
 460   1      
 461   1        for(i=0;i<1;i++); 
 462   1      
 463   1      } 
 464          
 465            
 466          
 467          //***************************************************************  
 468          
 469          //lcdÄ£¿é// 
 470          
 471          BOOL lcd_bz()//²âÊÔlcdÃ¦Âµ×´Ì¬ª£·µ»ØÖµÎª²¼¶ûĞÍÊıÖµª£Õæ»ò¼Ùª¡'1'.'0'ª¢  
 472          
 473          { 
 474   1      
 475   1       BOOL result;
 476   1        rs=0;           // ¶ÁÃ¦ĞÅºÅ
 477   1        rw=1;
 478   1        ep=1;
 479   1        _nop_();
 480   1        _nop_();
 481   1        _nop_();
 482   1        _nop_();
 483   1        result = (BOOL)(P2&0x80);
 484   1        ep=0;
 485   1      return  result ;
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 9   

 486   1      
 487   1      }     
 488          
 489          void write_cmd(unsigned char cmd)//Ğ´Ö¸Áî// 
 490          
 491          { 
 492   1      
 493   1        while (lcd_bz());
 494   1        rs=0;
 495   1        rw=0;
 496   1        ep=0;
 497   1        _nop_();
 498   1        _nop_();
 499   1        P2=cmd ;
 500   1        _nop_();
 501   1        _nop_();
 502   1        _nop_();
 503   1        _nop_();
 504   1        ep=1;
 505   1        _nop_();
 506   1        _nop_();
 507   1        _nop_();
 508   1        _nop_();
 509   1        ep=0;
 510   1      
 511   1      } 
 512          
 513           
 514          
 515          void write_addr(unsigned char addr)//Ğ´µØÖ·// 
 516          
 517          { 
 518   1      
 519   1        write_cmd(addr|0x80);//LCDµÚÒ»ĞĞµÄÊ×µØÖ·Îª0x80ª¡µÚ¶şĞĞµÄÊ×µØÖ·Îª0x80+0x40=0xc0 
 520   1      
 521   1      } 
 522          
 523           
 524          
 525          void write_byte(unsigned char dat) //Ğ´×Ö½Ú// 
 526          
 527          { 
 528   1      
 529   1         while (lcd_bz());
 530   1        rs=1;
 531   1        rw=0;
 532   1        ep=0;
 533   1        _nop_();
 534   1        _nop_();
 535   1        P2=dat ;
 536   1        _nop_();
 537   1        _nop_();
 538   1        _nop_();
 539   1        _nop_();
 540   1        ep=1;
 541   1        _nop_();
 542   1        _nop_();
 543   1        _nop_();
 544   1        _nop_();
 545   1        ep=0;
 546   1      
 547   1      } 
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 10  

 548          
 549           
 550          
 551          void lcd_init() //lcd³õÊ¼»¯// 
 552          
 553          { 
 554   1      
 555   1        write_cmd(0x38);//ÉèÖÃLCDÁ½ĞĞÏÔÊ¾ª¡Ò»¸öÊı¾İÓÉ5*7µãÕó±íÊ¾,Êı¾İÓÉ8¸úÏß´«Êä 
 556   1      
 557   1        delay(1); 
 558   1      
 559   1        write_cmd(0x0c);//Çå³ıÆÁÄ»ÏÔÊ¾ 
 560   1      
 561   1        delay(1); 
 562   1      
 563   1        write_cmd(0x06);//Éè¶¨ÊäÈë·½Ê½ª¡ÔöÁ¿²»ÒÆÎ» 
 564   1      
 565   1        delay(1); 
 566   1      
 567   1        write_cmd(0x01);//¿ªÕûÌåÏÔÊ¾ª¡¹Ø¹â±êª¡²»ÉÁË¸ 
 568   1      
 569   1        delay(1); 
 570   1      
 571   1      } 
 572          
 573           
 574          
 575          void display(unsigned char addr,unsigned char q)//ÔÚÄ³Ò»µØÖ·ÉÏÏÔÊ¾ÄÚÈİª¡adder±íÊ¾µÄÊÇµØÖ·Æ«ÒÆÁ¿ª¡q±íÊ¾ÏÔÊ¾
             -µÄ×Ö·û»òÊı×Ö// 
 576          
 577          { 
 578   1      
 579   1        delay(10);   write_addr(addr); 
 580   1      
 581   1        write_byte(q); 
 582   1      
 583   1        delay(1);//ĞŞ¸Ä´ËÊ±¼äª£¿ÉÒÔ¸Ä±äLCDÉÏÊıÖµÌø±äµÄÊı¶È 
 584   1      
 585   1      } 
 586          
 587           
 588          
 589          //**************************dht11²âÊÔÄ³¿é*************************************// 
 590          
 591          void start()//¿ªÊ¼ĞÅºÅ 
 592          
 593          { 
 594   1      
 595   1        io=1; 
 596   1      
 597   1        delay1(); 
 598   1      
 599   1        io=0; 
 600   1      
 601   1        delay(25);// Ö÷»ú°Ñ×ÜÏßÀ­µÍ±ØĞë´óÓÚ18msª£±£Ö¤DHT11ÄÜ¼ì²âµ½ÆğÊ¼ĞÅºÅ 
 602   1      
 603   1        io=1;    //·¢ËÍ¿ªÊ¼ĞÅºÅ½áÊøºóª£À­¸ßµçÆ½ÑÓÊ±20-40us 
 604   1      
 605   1        delay1();//ÒÔÏÂÈı¸öÑÓÊ±º¯Êı²î²»¶àÎª24usª£·ûºÏÒªÇó 
 606   1      
 607   1        delay1(); 
 608   1      
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 11  

 609   1        delay1(); 
 610   1      
 611   1      } 
 612          
 613           
 614          
 615          unsigned char receive_byte()//½ÓÊÕÒ»¸ö×Ö½Ú// 
 616          
 617          { 
 618   1      
 619   1        unsigned char i,temp; 
 620   1      
 621   1        for(i=0;i<8;i++)//½ÓÊÕ8bitµÄÊı¾İ 
 622   1      
 623   1        { 
 624   2      
 625   2        while(!io);//µÈ´ı50usµÄµÍµçÆ½¿ªÊ¼ĞÅºÅ½áÊø 
 626   2      
 627   2        delay1();//¿ªÊ¼ĞÅºÅ½áÊøÖ®ºóª£ÑÓÊ±26us-28usª¡ÒÔÏÂÈı¸öÑÓÊ±º¯Êıª¢ 
 628   2      
 629   2         delay1(); 
 630   2      
 631   2        delay1(); 
 632   2      
 633   2        temp=0;//Ê±¼äÎª26us-28usª£±íÊ¾½ÓÊÕµÄÎªÊı¾İ'0' 
 634   2      
 635   2        if(io==1) 
 636   2      
 637   2         temp=1; //Èç¹û26us-28usÖ®ºóª£»¹Îª¸ßµçÆ½ª£Ôò±íÊ¾½ÓÊÕµÄÊı¾İÎª'1' 
 638   2      
 639   2          while(io);//µÈ´ıÊı¾İĞÅºÅ¸ßµçÆ½ª¡'0'Îª26us-28usª£'1'Îª70usª¢ 
 640   2      
 641   2        data_byte<<=1;//½ÓÊÕµÄÊı¾İÎª¸ßÎ»ÔÚÇ°ª¡ÓÒÒÆª¢ 
 642   2      
 643   2         data_byte|=temp; 
 644   2      
 645   2        } 
 646   1      
 647   1        return data_byte; 
 648   1      
 649   1      } 
 650          
 651              
 652          
 653          void receive()//½ÓÊÕÊı¾İ// 
 654          
 655          { 
 656   1      
 657   1        unsigned char T_H,T_L,R_H,R_L,check,num_check,i; 
 658   1      
 659   1        start();//¿ªÊ¼ĞÅºÅ// 
 660   1      
 661   1        io=1;   //Ö÷»úÉèÎªÊäÈëª£ÅĞ¶Ï´Ó»úª¡DHT11ª¢ÏìÓ¦ĞÅºÅ 
 662   1      
 663   1        if(!io)//ÅĞ¶Ï´Ó»úÊÇ·ñÓĞµÍµçÆ½ÏìÓ¦ĞÅºÅ// 
 664   1      
 665   1        {  
 666   2        while(!io);//ÅĞ¶Ï´Ó»ú·¢³ö 80us µÄµÍµçÆ½ÏìÓ¦ĞÅºÅÊÇ·ñ½áÊø// 
 667   2      
 668   2        while(io);//ÅĞ¶Ï´Ó»ú·¢³ö 80us µÄ¸ßµçÆ½ÊÇ·ñ½áÊøª£Èç½áÊøÔòÖ÷»ú½øÈëÊı¾İ½ÓÊÕ×´Ì¬ 
 669   2      
 670   2        R_H=receive_byte();//Êª¶È¸ßÎ» 
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 12  

 671   2      
 672   2        R_L=receive_byte();//Êª¶ÈµÍÎ» 
 673   2      
 674   2        T_H=receive_byte();//ÎÂ¶È¸ßÎ» 
 675   2      
 676   2        T_L=receive_byte();//ÎÂ¶ÈµÍÎ» 
 677   2      
 678   2        check=receive_byte();//Ğ£ÑéÎ» 
 679   2      
 680   2        io=0; //µ±×îºóÒ»bitÊı¾İ½ÓÍê±Ïºóª£´Ó»úÀ­µÍµçÆ½50us// 
 681   2      
 682   2        for(i=0;i<7;i++)//²î²»¶à50usµÄÑÓÊ± 
 683   2      
 684   2        delay1(); 
 685   2      
 686   2        io=1;//×ÜÏßÓÉÉÏÀ­µç×èÀ­¸ßª£½øÈë¿ÕÏĞ×´Ì¬ 
 687   2      
 688   2        num_check=R_H+R_L+T_H+T_L; 
 689   2      
 690   2        if(num_check==check)//ÅĞ¶Ï¶Áµ½µÄËÄ¸öÊı¾İÖ®ºÍÊÇ·ñÓëĞ£ÑéÎ»ÏàÍ¬ 
 691   2      
 692   2        { 
 693   3      
 694   3         RH=R_H; 
 695   3      
 696   3         RL=R_L; 
 697   3      
 698   3         TH=T_H; 
 699   3      
 700   3         TL=T_L; 
 701   3      
 702   3         check=num_check; 
 703   3      
 704   3        } 
 705   2      
 706   2        } 
 707   1      
 708   1      } 
 709          
 710          //*****************************************************************************
 711          
 712           
 713          
 714          void DHT_display()//Ö÷º¯ÊıÄ£¿é// 
 715          
 716          { 
 717   1      
 718   1        lcd_init();//³õÊ¼»¯LCD 
 719   1      
 720   1        while(1) 
 721   1      
 722   1        { Delay1s();Delay1s();
 723   2      
 724   2          receive();//½ÓÊÕÊı¾İ 
 725   2      
 726   2       
 727   2      
 728   2      
 729   2      
 730   2       display(0x00,RH/10+0x30); //0x30±íÊ¾ª¤´ø×Ö¿âµÄLCD1602ÖĞ0x30µÄÎ»ÖÃ·ÅÓĞÊı×Ö0ª¡RH/10+0x30¼´±íÊ¾Êª¶ÈµÄÊ®Î»Êı×
             -ÖÔÚ×Ö¿âRH/10+0x30µÄÎ»ÖÃ´¦·Å×Åª¢ 
 731   2      
C51 COMPILER V9.54   MAIN                                                                  02/10/2020 23:35:50 PAGE 13  

 732   2       display(0x01,RH%10+0x30); 
 733   2      
 734   2       display(0X03,'%'); 
 735   2      
 736   2      
 737   2       display(0X04,'/'); 
 738   2       display(0x42-0x3d,TH/10+0x30); 
 739   2      
 740   2       display(0x43-0x3d,TH%10+0x30); 
 741   2      
 742   2       display(0x44-0x3d,0xdf);//ÒÔÏÂÁ½¸öÊÇÎÂ¶Èµ¥Î»µÄ´¦Àí 
 743   2      
 744   2       display(0x45-0x3d,0x43); 
 745   2      
 746   2        } 
 747   1      } 
 748          
 749          
 750          void Back_Send_Sms()
 751          {
 752   1        
 753   1        xdata char buf[200]="";
 754   1        sprintf(buf,"%s6E7F%s%s%s6E29%s",buff,RH_TM_Buf,NumBuf[RH/10],NumBuf[RH%10],RH_TM_Buf);
 755   1        Send_Sms(buf,strlen(buf)-18);
 756   1      }
 757          
 758          void Send_Sms(char *sms,int len)
 759          {
 760   1        xdata char buf[12]="";
 761   1        sprintf(buf,"AT+CMGS=%d",len);
 762   1        Second_AT_Command(buf,">",3); //·¢ËÍÊı¾İ³¤¶È£º27£¨¾ßÌåµÄ¼ÆËã·½·¨¿´´®¿Úµ÷ÊÔ±È½Ï£©½ÓÊÕµ½¡°>¡±²Å·¢ËÍ¶ÌĞÅÄÚÈİ
 763   1        UART1_SendString(sms);     //·¢ËÍ¶ÌĞÅÄÚÈİ
 764   1        UART1_SendData(0X1A);          //·¢ËÍ½áÊø·û
 765   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1460    ----
   CONSTANT SIZE    =    649    ----
   XDATA SIZE       =    200     212
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      47
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
